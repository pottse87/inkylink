"use strict";

const {
  test,
  expect
} = require('@playwright/test');
const fs = require('fs');
const {
  Client
} = require('pg');
test('Inkylink full pipeline + DB check', async ({
  page
}) => {
  const baseUrl = 'http://localhost:3000';

  // 1. Go to pricing page
  await page.goto(`${baseUrl}/pricing`);
  await expect(page.locator('h1')).toContainText('Inkylink');

  // 2. Click first "Order Now"
  await page.locator('text=Order Now').first().click();

  // 3. Confirmation page
  await expect(page).toHaveURL(/confirmation/);

  // 4. Continue to form
  await page.locator('text=Continue to Intake Form').click();

  // 5. Fill all inputs
  const inputs = page.locator('input[type="text"]');
  const count = await inputs.count();
  for (let i = 0; i < count; i++) {
    await inputs.nth(i).fill(`Sample answer ${i + 1}`);
  }

  // 6. Submit form
  await page.locator('text=Submit').click();

  // 7. Thank you page
  await expect(page).toHaveURL(/thankyou/);

  // 8. Verify local orders folder
  const ordersPath = './orders';
  if (!fs.existsSync(ordersPath)) throw new Error('❌ Orders folder not found');
  const files = fs.readdirSync(ordersPath);
  if (!files.length) throw new Error('❌ No order files found in orders folder');
  console.log('✅ Order saved locally:', files[files.length - 1]);

  // 9. Verify IDs have no hyphens
  const latestOrderPath = `${ordersPath}/${files[files.length - 1]}`;
  const orderData = JSON.parse(fs.readFileSync(latestOrderPath, 'utf8'));
  const idsWithHyphens = Array.isArray(orderData.items) ? orderData.items.filter(item => item.id.includes("-")) : [];
  if (!Array.isArray(orderData.items)) {
    console.warn("?? No items array found in latest order file.");
  }
  if (idsWithHyphens.length > 0) {
    throw new Error(`❌ Found IDs with hyphens: ${idsWithHyphens.map(i => i.id).join(', ')}`);
  }
  console.log('✅ All IDs have spaces instead of hyphens');

  // 10. PostgreSQL DB verification
  const client = new Client({
    host: process.env.PGHOST,
    port: process.env.PGPORT,
    database: process.env.PGDATABASE,
    user: process.env.PGUSER,
    password: process.env.PGPASSWORD
  });
  try {
    await client.connect();
    const res = await client.query('SELECT order_id, submitted_at FROM orders ORDER BY submitted_at DESC LIMIT 1');
    if (res.rows.length === 0) {
      throw new Error('❌ No orders found in PostgreSQL');
    } else {
      console.log('✅ Latest order in PostgreSQL:', res.rows[0]);
    }
  } catch (err) {
    console.warn('⚠️ PostgreSQL check failed:', err.message);
  } finally {
    await client.end();
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJ0ZXN0IiwiZXhwZWN0IiwicmVxdWlyZSIsImZzIiwiQ2xpZW50IiwicGFnZSIsImJhc2VVcmwiLCJnb3RvIiwibG9jYXRvciIsInRvQ29udGFpblRleHQiLCJmaXJzdCIsImNsaWNrIiwidG9IYXZlVVJMIiwiaW5wdXRzIiwiY291bnQiLCJpIiwibnRoIiwiZmlsbCIsIm9yZGVyc1BhdGgiLCJleGlzdHNTeW5jIiwiRXJyb3IiLCJmaWxlcyIsInJlYWRkaXJTeW5jIiwibGVuZ3RoIiwiY29uc29sZSIsImxvZyIsImxhdGVzdE9yZGVyUGF0aCIsIm9yZGVyRGF0YSIsIkpTT04iLCJwYXJzZSIsInJlYWRGaWxlU3luYyIsImlkc1dpdGhIeXBoZW5zIiwiQXJyYXkiLCJpc0FycmF5IiwiaXRlbXMiLCJmaWx0ZXIiLCJpdGVtIiwiaWQiLCJpbmNsdWRlcyIsIndhcm4iLCJtYXAiLCJqb2luIiwiY2xpZW50IiwiaG9zdCIsInByb2Nlc3MiLCJlbnYiLCJQR0hPU1QiLCJwb3J0IiwiUEdQT1JUIiwiZGF0YWJhc2UiLCJQR0RBVEFCQVNFIiwidXNlciIsIlBHVVNFUiIsInBhc3N3b3JkIiwiUEdQQVNTV09SRCIsImNvbm5lY3QiLCJyZXMiLCJxdWVyeSIsInJvd3MiLCJlcnIiLCJtZXNzYWdlIiwiZW5kIl0sInNvdXJjZXMiOlsiaW5reWxpbmsuc3BlYy5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJjb25zdCB7IHRlc3QsIGV4cGVjdCB9ID0gcmVxdWlyZSgnQHBsYXl3cmlnaHQvdGVzdCcpO1xyXG5jb25zdCBmcyA9IHJlcXVpcmUoJ2ZzJyk7XHJcbmNvbnN0IHsgQ2xpZW50IH0gPSByZXF1aXJlKCdwZycpO1xyXG5cclxudGVzdCgnSW5reWxpbmsgZnVsbCBwaXBlbGluZSArIERCIGNoZWNrJywgYXN5bmMgKHsgcGFnZSB9KSA9PiB7XHJcbiAgY29uc3QgYmFzZVVybCA9ICdodHRwOi8vbG9jYWxob3N0OjMwMDAnO1xyXG5cclxuICAvLyAxLiBHbyB0byBwcmljaW5nIHBhZ2VcclxuICBhd2FpdCBwYWdlLmdvdG8oYCR7YmFzZVVybH0vcHJpY2luZ2ApO1xyXG4gIGF3YWl0IGV4cGVjdChwYWdlLmxvY2F0b3IoJ2gxJykpLnRvQ29udGFpblRleHQoJ0lua3lsaW5rJyk7XHJcblxyXG4gIC8vIDIuIENsaWNrIGZpcnN0IFwiT3JkZXIgTm93XCJcclxuICBhd2FpdCBwYWdlLmxvY2F0b3IoJ3RleHQ9T3JkZXIgTm93JykuZmlyc3QoKS5jbGljaygpO1xyXG5cclxuICAvLyAzLiBDb25maXJtYXRpb24gcGFnZVxyXG4gIGF3YWl0IGV4cGVjdChwYWdlKS50b0hhdmVVUkwoL2NvbmZpcm1hdGlvbi8pO1xyXG5cclxuICAvLyA0LiBDb250aW51ZSB0byBmb3JtXHJcbiAgYXdhaXQgcGFnZS5sb2NhdG9yKCd0ZXh0PUNvbnRpbnVlIHRvIEludGFrZSBGb3JtJykuY2xpY2soKTtcclxuXHJcbiAgLy8gNS4gRmlsbCBhbGwgaW5wdXRzXHJcbiAgY29uc3QgaW5wdXRzID0gcGFnZS5sb2NhdG9yKCdpbnB1dFt0eXBlPVwidGV4dFwiXScpO1xyXG4gIGNvbnN0IGNvdW50ID0gYXdhaXQgaW5wdXRzLmNvdW50KCk7XHJcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XHJcbiAgICBhd2FpdCBpbnB1dHMubnRoKGkpLmZpbGwoYFNhbXBsZSBhbnN3ZXIgJHtpICsgMX1gKTtcclxuICB9XHJcblxyXG4gIC8vIDYuIFN1Ym1pdCBmb3JtXHJcbiAgYXdhaXQgcGFnZS5sb2NhdG9yKCd0ZXh0PVN1Ym1pdCcpLmNsaWNrKCk7XHJcblxyXG4gIC8vIDcuIFRoYW5rIHlvdSBwYWdlXHJcbiAgYXdhaXQgZXhwZWN0KHBhZ2UpLnRvSGF2ZVVSTCgvdGhhbmt5b3UvKTtcclxuXHJcbiAgLy8gOC4gVmVyaWZ5IGxvY2FsIG9yZGVycyBmb2xkZXJcclxuICBjb25zdCBvcmRlcnNQYXRoID0gJy4vb3JkZXJzJztcclxuICBpZiAoIWZzLmV4aXN0c1N5bmMob3JkZXJzUGF0aCkpIHRocm93IG5ldyBFcnJvcign4p2MIE9yZGVycyBmb2xkZXIgbm90IGZvdW5kJyk7XHJcbiAgY29uc3QgZmlsZXMgPSBmcy5yZWFkZGlyU3luYyhvcmRlcnNQYXRoKTtcclxuICBpZiAoIWZpbGVzLmxlbmd0aCkgdGhyb3cgbmV3IEVycm9yKCfinYwgTm8gb3JkZXIgZmlsZXMgZm91bmQgaW4gb3JkZXJzIGZvbGRlcicpO1xyXG4gIGNvbnNvbGUubG9nKCfinIUgT3JkZXIgc2F2ZWQgbG9jYWxseTonLCBmaWxlc1tmaWxlcy5sZW5ndGggLSAxXSk7XHJcblxyXG4gIC8vIDkuIFZlcmlmeSBJRHMgaGF2ZSBubyBoeXBoZW5zXHJcbiAgY29uc3QgbGF0ZXN0T3JkZXJQYXRoID0gYCR7b3JkZXJzUGF0aH0vJHtmaWxlc1tmaWxlcy5sZW5ndGggLSAxXX1gO1xyXG4gIGNvbnN0IG9yZGVyRGF0YSA9IEpTT04ucGFyc2UoZnMucmVhZEZpbGVTeW5jKGxhdGVzdE9yZGVyUGF0aCwgJ3V0ZjgnKSk7XHJcbiAgY29uc3QgaWRzV2l0aEh5cGhlbnMgPSBBcnJheS5pc0FycmF5KG9yZGVyRGF0YS5pdGVtcykgPyBvcmRlckRhdGEuaXRlbXMuZmlsdGVyKGl0ZW0gPT4gaXRlbS5pZC5pbmNsdWRlcyhcIi1cIikpIDogW107XG5pZiAoIUFycmF5LmlzQXJyYXkob3JkZXJEYXRhLml0ZW1zKSkge1xuICBjb25zb2xlLndhcm4oXCI/PyBObyBpdGVtcyBhcnJheSBmb3VuZCBpbiBsYXRlc3Qgb3JkZXIgZmlsZS5cIik7XG59XHJcbiAgaWYgKGlkc1dpdGhIeXBoZW5zLmxlbmd0aCA+IDApIHtcclxuICAgIHRocm93IG5ldyBFcnJvcihg4p2MIEZvdW5kIElEcyB3aXRoIGh5cGhlbnM6ICR7aWRzV2l0aEh5cGhlbnMubWFwKGkgPT4gaS5pZCkuam9pbignLCAnKX1gKTtcclxuICB9XHJcbiAgY29uc29sZS5sb2coJ+KchSBBbGwgSURzIGhhdmUgc3BhY2VzIGluc3RlYWQgb2YgaHlwaGVucycpO1xyXG5cclxuICAvLyAxMC4gUG9zdGdyZVNRTCBEQiB2ZXJpZmljYXRpb25cclxuICBjb25zdCBjbGllbnQgPSBuZXcgQ2xpZW50KHtcclxuICAgIGhvc3Q6IHByb2Nlc3MuZW52LlBHSE9TVCxcclxuICAgIHBvcnQ6IHByb2Nlc3MuZW52LlBHUE9SVCxcclxuICAgIGRhdGFiYXNlOiBwcm9jZXNzLmVudi5QR0RBVEFCQVNFLFxyXG4gICAgdXNlcjogcHJvY2Vzcy5lbnYuUEdVU0VSLFxyXG4gICAgcGFzc3dvcmQ6IHByb2Nlc3MuZW52LlBHUEFTU1dPUkQsXHJcbiAgfSk7XHJcblxyXG4gIHRyeSB7XHJcbiAgICBhd2FpdCBjbGllbnQuY29ubmVjdCgpO1xyXG4gICAgY29uc3QgcmVzID0gYXdhaXQgY2xpZW50LnF1ZXJ5KCdTRUxFQ1Qgb3JkZXJfaWQsIHN1Ym1pdHRlZF9hdCBGUk9NIG9yZGVycyBPUkRFUiBCWSBzdWJtaXR0ZWRfYXQgREVTQyBMSU1JVCAxJyk7XHJcbiAgICBpZiAocmVzLnJvd3MubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgIHRocm93IG5ldyBFcnJvcign4p2MIE5vIG9yZGVycyBmb3VuZCBpbiBQb3N0Z3JlU1FMJyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zb2xlLmxvZygn4pyFIExhdGVzdCBvcmRlciBpbiBQb3N0Z3JlU1FMOicsIHJlcy5yb3dzWzBdKTtcclxuICAgIH1cclxuICB9IGNhdGNoIChlcnIpIHtcclxuICAgIGNvbnNvbGUud2Fybign4pqg77iPIFBvc3RncmVTUUwgY2hlY2sgZmFpbGVkOicsIGVyci5tZXNzYWdlKTtcclxuICB9IGZpbmFsbHkge1xyXG4gICAgYXdhaXQgY2xpZW50LmVuZCgpO1xyXG4gIH1cclxufSk7XHJcbiJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxNQUFNO0VBQUVBLElBQUk7RUFBRUM7QUFBTyxDQUFDLEdBQUdDLE9BQU8sQ0FBQyxrQkFBa0IsQ0FBQztBQUNwRCxNQUFNQyxFQUFFLEdBQUdELE9BQU8sQ0FBQyxJQUFJLENBQUM7QUFDeEIsTUFBTTtFQUFF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